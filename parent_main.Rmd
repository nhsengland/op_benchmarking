---
title: "DRAFT Outpatient benchmarking overview"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: fill
---

```{css}
.value-box {
  height: 25%;
}

.chart-title {
    font-size: 18px;
}

```

```{r, setup, include= FALSE }

## create the data frames

## currently using faked data so what we pull in will change when using live sources
## but the flow should remain the same
source('Rscripts\\mock_up.R')
```

# Cover {data-orientation="columns"}

## Column {data-width="300"}

### Purpose of this document

The purpose of this document is to give systems and providers in the South East access to benchmarking information related to key outpatient recovery and transformation workstreams.

**This document is a prototype created for comment and feedback. All of the values provided are randomly generated and bear no relation to the trust's actual performance**

## Column {data-width="400"}

### System and provider acronyms

Acronyms and shortened names used within this document to represent systems and providers are:

[System names:]{.underline}

-   BOB - NHS Buckinghamshire, Oxfordshire and Berkshire West ICB
-   Frimley - NHS Frimley ICB
-   HIOW - NHS Hampshire and Isle of Wight ICB
-   KM - NHS Kent and Medway ICB
-   Surrey - NHS Surrey Heartlands ICB
-   Sussex - NHS Sussex ICB

[Provider names:]{.underline}

-   ASP - Ashford and St Peter's Hospitals NHS Foundation Trust
-   BHT - Buckinghamshire Healthcare NHS Trust
-   DGT - Dartford and Gravesham NHS Trust
-   EKH - East Kent Hospitals University NHS Foundation Trust
-   ESH - East Sussex Healthcare NHS Trust
-   Frimley - Frimley Health NHS Foundation Trust
-   HHFT - Hampshire Hospitals NHS Foundation Trust
-   IOW - Isle of Wight NHS Trust
-   MFT - Medway NHS Foundation Trust
-   MTW - Maidstone and Tunbridge Wells NHS Trust
-   OUH - Oxford University Hospitals NHS Foundation Trust
-   PHU - Portsmouth Hospitals University National Health Service Trust
-   QVH - Queen Victoria Hospital NHS Foundation Trust
-   RBH - Royal Berkshire NHS Foundation Trust
-   RSCH - Royal Surrey County Hospital NHS Foundation Trust
-   SASH - Surrey and Sussex Healthcare NHS Trust
-   UHS - University Hospital Southampton NHS Foundation Trust
-   UHSX - University Hospitals Sussex NHS Foundation Trust

## Column {data-width="300"}

### Other acronyms used in this report

-   SA: Specialist advice
-   OPFA: Outpatient First Attendance
-   New: Outpatient First Attendance
-   OPFU: Outpatient Follow-up Attendance
-   FU: Outpatient Follow-up Attendance
-   RTT: Referral To Treatment
-   HRG: Healthcare Resource Group
-   EROC: Elective Recovery Outpatient Collection

# Methodology {data-orientation="columns"}

**Proposed metrics - not yet live in this prototype**

## Column {data-width="334"}

**SA per 100 OPFA: Specialist advice per 100 outpatient first attendances**

Numerator:
  Sum of all System EROC Processed Requests within the reporting period

Denominator:
  Sum of all Outpatient attendances in line with above criteria, for the same reporting period as the numerator

**SA Diversion Rate: Specialist advice diversion rate per 100 requests**

Numerator:
  Sum of all processed requests where the outcome is:
  'Return to referrer with advice no onward referral or booking' or
  'Return to referrer with advice other'

Denominator:
  Sum of all System EROC Reported Requests (All Requests from all sources) within the reporting period

**Average Wait to OPFA: Average wait to first outpatient attendance (weeks)**

Mean time in weeks between the referral request received date and the appointment date as reported on SUS for all routine outpatient first attendances for NHS funded care (ie excluding urgent and two week wait appointments)

  First Attendance codes: 1 and 3\
  Attendance status codes: 5 and 6\
  Administrative category code: 01 Priority code: 1

## Column {data-width="333"}

**Discharge after OPFA: Percentage of patients discharged after a first outpatient appointment**

Numerator:\
    Sum of all OPFA, excluding diagnostic appointments (treatment function code: 812) where no procedure took place (activity grouped to an HRG in the WF subchapter) and the outcome of the attendance was recorded as a discharge (Outcome of attendance code: 1)

Denominator:\
    Sum of all OPFA, excluding diagnostic appointments (treatment function code: 812) where no procedure took place (activity grouped to an HRG in the WF subchapter)

  First Attendance codes: 1 and 3\
  Attendance status codes: 5 and 6\
  Administrative category code: 01

**New:FU ratio: Outpatient new to follow-up ratio**

The average number of follow up appointments per 1 first outpatient appointment.\

Numerator:\
  Sum of all attended OPFU, excluding diagnostic appointments (treatment function code: 812)

  First Attendance codes: 2 and 4\
  Attendance status codes: 5 and 6\
  Administrative category code: 01

Denominator:\
  Sum of all attended OPFA, excluding diagnostic appointments (treatment function code: 812)

  First Attendance codes: 1 and 3\
  Attendance status codes: 5 and 6\
  Administrative category code: 01

**Percentage of patients moved or discharged to PIFU**

Numerator:\
  Sum of all PIFU pathways moved or discharged within the reporting period as reported in Provider EROC

Denominator:\
    Sum of all attended outpatient appointments (new and follow-up), excluding those classified an RTT clock stop administration event (First Attendance code = 5)

  First Attendance codes: 1, 2, 3 and 4\
  Attendance status codes: 5 and 6\
  Administrative category code: 01

## Column {data-width="333"}

**Percentage of Missed appointments**

**Outpatient follow-up reduction compared to 19/20 baseline**

**Percentage of open RTT pathways validated in last 12 weeks**

```{r, create-subpages, include = FALSE}
metric_env <- new.env()
spec_env <- new.env()
out = NULL

assign("table_red","#F08080",metric_env)  
assign("table_amber",'#D1B05F',metric_env)  
assign("table_green","#90EE90",metric_env)  
assign("table_red","#F08080",spec_env)  
assign("table_amber",'#D1B05F',spec_env)  
assign("table_green","#90EE90",spec_env)  

options(knitr.duplicate.label = 'allow')

for (met in metric) {
  met <- met

metric_data  <- all_metrics %>% 
  filter(metric_name == met) %>% 
  select(speciality,
         system,
         provider,
         value) %>% 
  pivot_wider(names_from = c(speciality),
              values_from = value)
assign("met",met,metric_env)  
assign("metric_data",metric_data,metric_env)

out = c(out, knitr::knit_child('RScripts\\child_metrics.Rmd',envir = metric_env))  
  
}

for (spec in specialities) {
spec <- spec
spec_data <- all_metrics %>% 
  filter(speciality == spec) %>% 
  select(system,
         provider,
         metric_name,
         value) %>% 
  pivot_wider(names_from = metric_name,
              values_from = value)

assign("spec",spec,spec_env)
assign("spec_data",spec_data,spec_env)


out = c(out, knitr::knit_child('RScripts\\child_specs.Rmd',envir = spec_env))

}

```

`r paste(knitr::knit_child(text = out), collapse = '')`
